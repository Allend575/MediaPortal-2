<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Fragment>
    <?include ..\Includes.wxi ?>

    <DirectoryRef Id="INSTALLDIR_SERVER" FileSource="$(var.OutDirServer)">

      <Directory Id="S__Defaults" Name="Defaults">
        <Component Id="S__Defaults" Guid="9894844B-C89B-4F8D-A905-751B836A5DF3">
          <File Id="S__Paths.xml" Name="Paths.xml" Checksum="yes" />
        </Component>
      </Directory>

      <Directory Id="Scripts" Name="Scripts">
        <Component Id="Scripts" Guid="502F6E53-EA39-43D0-9098-10B512D332A6">
          <File Id="ClientManager_create_1.0.sql" Name="ClientManager-create-1.0.sql" Checksum="yes" />
          <File Id="MediaLibrary_create_1.0.sql" Name="MediaLibrary-create-1.0.sql" Checksum="yes" />
          <File Id="MediaPortal_Basis_create_1.0.sql" Name="MediaPortal-Basis-create-1.0.sql" Checksum="yes" />
        </Component>
      </Directory>

      <Directory Id="ServerPluginsFolder" Name="Plugins"/>

      <Component Id="MP2Server" Guid="3AF13E59-DC3A-4C6F-A0EB-89462019140C">
        <File Id="MP2Server.exe" Name="MP2-Server.exe" />
        <File Id="MP2Server.exe.config" Name="MP2-Server.exe.config" />
      </Component>
      <Component Id="S__HttpServer" Guid="85F6FE7A-B5C5-4934-BDE1-53EA8A166762">
        <File Id="S__HttpServer.dll" Name="HttpServer.dll" KeyPath="yes" Checksum="yes" />
      </Component>
      <Component Id="S__log4net" Guid="B8B1CA85-3224-4287-86D0-06A391B0F43F">
        <File Id="S__log4net.dll" Name="log4net.dll" KeyPath="yes" Checksum="yes" />
      </Component>
      <Component Id="MediaPortal.Backend" Guid="C6555D68-586C-45FF-9E5B-92C00F6E3A25">
        <File Id="MediaPortal.Backend.dll" Name="MediaPortal.Backend.dll" KeyPath="yes" Checksum="yes" />
      </Component>
      <Component Id="S__MediaPortal.Core" Guid="51EFED2C-A252-4EEF-9C72-4829DA11FC27">
        <File Id="S__MediaPortal.Core.dll" Name="MediaPortal.Core.dll" KeyPath="yes" Checksum="yes" />
      </Component>
      <Component Id="S__MediaPortal.Utilities" Guid="9726D595-7054-438A-9E77-39ECEE934769">
        <File Id="S__MediaPortal.Utilities.dll" Name="MediaPortal.Utilities.dll" KeyPath="yes" Checksum="yes" />
      </Component>
      <Component Id="S__UPnP" Guid="EC221FE7-04DC-4734-AC0F-0527B6B6BB01">
        <File Id="S__UPnP.dll" Name="UPnP.dll" KeyPath="yes" Checksum="yes" />
      </Component>

    </DirectoryRef>

    <!-- StartMenu shortcuts -->
    <DirectoryRef Id="ProgramMenuFolder">
      <Directory Id="MP2Server.MP2ProgramMenu" Name="MediaPortal 2">
        <Component Id="MP2Server.ProgramMenuItems" Guid="90A5BA29-FEF2-4BB6-85AE-929ABA5F42EF">
          <!--
          Fix ICE 38 by adding a dummy registry key that is the key for this shortcut.
          http://msdn.microsoft.com/library/en-us/msi/setup/ice38.asp
          -->
          <RegistryValue Id="MP2Server.StartMenuShortcutRegistryKey" Root="HKCU" Type="string" KeyPath="yes" Key="Software\Team MediaPortal\MediaPortal 2" Name="MP2Server.ProgramFilesShortcut" Value="1" />
          <Shortcut Id="MP2Server.StartMenuShortcut" Name="MediaPortal 2 Server" Target="[!MP2Server.exe]" WorkingDirectory="INSTALLDIR_CLIENT" Icon="MediaPortalIcon" Directory="MP2Server.MP2ProgramMenu" />

          <RemoveFolder Id="MP2Server.RemoveFolder_MP2ProgramMenu" Directory="MP2Server.MP2ProgramMenu" On="uninstall"/>
        </Component>
      </Directory>
    </DirectoryRef>

    <!-- Desktop shortcuts -->
    <DirectoryRef Id="DesktopFolder">
      <Component Id="MP2Server.DesktopFolderItems" Guid="751AD25F-D690-4C01-8915-CD5DA4029F8E">
        <!--
        Fix ICE 38 by adding a dummy registry key that is the key for this shortcut.
        http://msdn.microsoft.com/library/en-us/msi/setup/ice38.asp
        -->
        <RegistryValue Id="MP2Server.DesktopShortcutRegistryKey" Root="HKCU" Type="string" KeyPath="yes" Key="Software\Team MediaPortal\MediaPortal 2" Name="MP2Server.DesktopShortcut" Value="1" />
        <Shortcut Id="MP2Server.DesktopShortcut" Name="MediaPortal 2 Server" Target="[!MP2Server.exe]" WorkingDirectory="INSTALLDIR_SERVER" Icon="MediaPortalIcon" Directory="DesktopFolder" />
      </Component>
    </DirectoryRef>

    <!-- feature definition -->
    <Feature Id="MP2Server" Level="1" AllowAdvertise="no" ConfigurableDirectory="INSTALLDIR_SERVER" Title="Server" Description="Server description">

      <!-- Directories -->
      <ComponentRef Id="S__Defaults" />
      <ComponentRef Id="Scripts" />

      <!-- MP2 Server -->
      <ComponentRef Id="MP2Server" />
      <ComponentRef Id="MP2Server.DesktopFolderItems" />
      <ComponentRef Id="MP2Server.ProgramMenuItems" />

      <!-- Base -->
      <ComponentRef Id="S__HttpServer" />
      <ComponentRef Id="S__log4net" />
      <ComponentRef Id="MediaPortal.Backend" />
      <ComponentRef Id="S__MediaPortal.Core" />
      <ComponentRef Id="S__MediaPortal.Utilities" />
      <ComponentRef Id="S__UPnP" />

      <!-- Plugins -->
      <ComponentGroupRef Id="ServerPlugins"/>
    </Feature>

  </Fragment>
</Wix>