<?xml version="1.0"?>

<!--
  Note about XML namespace usage:
  - Default namespace is necessary for the output to be located in the default namespace
  - wix namespace necessary to match the input elements; default namespace doesn't work here
  - exclude-result-prefixes necessary to remove the wix namespace in the result document
-->
<xsl:stylesheet version="1.0"
    xmlns="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:wix="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:fn="http://www.w3.org/2005/xpath-functions"
    exclude-result-prefixes="wix">

  <xsl:output method="xml" indent="yes"/>

  <xsl:template match="/">
    <xsl:apply-templates/>
  </xsl:template>

  <xsl:template match="wix:Wix">
    <Wix>
      <xsl:comment>This file was generated by the XSLT stylesheet 'PluginComponents2Features.xslt'</xsl:comment>
      <xsl:apply-templates/>
    </Wix>
  </xsl:template>

  <xsl:template match="wix:Fragment">
    <xsl:choose>
      <xsl:when test="wix:DirectoryRef">
        <xsl:copy-of select="."/>
      </xsl:when>
      <xsl:when test="wix:ComponentGroup">
        <Fragment>
          <xsl:call-template name="CreatePluginsDirectoryFeatures"/>
        </Fragment>
      </xsl:when>
    </xsl:choose>
  </xsl:template>

  <xsl:template name="CollectComponentReferences">
    <xsl:for-each select="descendant-or-self::wix:Component">
      <ComponentRef>
        <xsl:attribute name="Id">
          <xsl:value-of select="@Id"/>
        </xsl:attribute>
      </ComponentRef>
    </xsl:for-each>
  </xsl:template>
</xsl:stylesheet>
